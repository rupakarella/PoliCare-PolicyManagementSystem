<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Policies</title>
    <link rel="stylesheet" href="explore-policies.component.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="explore-policies-container">
        <nav class="navbar">
            <img src="\assets\logo-no-background.png">
            <div class="nav-buttons">

                <button class="nav-button" routerLink="/profile">Profile</button>
                <button class="nav-button" routerLink="/user-policies">My Policies</button>
            </div>
        </nav>
        <h3 *ngIf="(!isUserLoggedIn() && !isAdminLoggedIn())"
            style="color: white; padding-top: 15px; text-align: center;"> Log in to Buy Now!</h3>

        <div *ngIf="showBuyForm" class="buy-form">
            <h2>Buy Policy</h2>
            <form [formGroup]="buyForm" (ngSubmit)="onBuyPolicy()">
                <div class="form-group">
                    <label for="start-date">Start Date:</label>
                    <input type="date" formControlName="startDate">
                    <div *ngIf="f['startDate'].invalid && f['startDate'].touched" class="error-message">
                        Start Date is required.
                    </div>
                </div>
                <div class="form-group">
                    <label for="durationInYears">Duration (in years):</label>
                    <input type="number" id="durationInYears" formControlName="durationInYears">
                    <div *ngIf="f['durationInYears'].invalid && f['durationInYears'].touched" class="error-message">
                        Duration is required.
                    </div>
                </div>
                <button type="submit" [disabled]="buyForm.invalid">Submit</button>
            </form>
        </div>

        <div *ngIf="!showBuyForm" class="search-table">
            <table class="table table-borderes">
                <thead class="thead">
                    <tr>
                        <th>Policy Id</th>
                        <th>Policy Name</th>
                        <th>Description</th>
                        <th>Company</th>
                        <th>Type</th>
                        <th>Initial Deposit</th>
                        <th>Term Period</th>
                        <th>Term Amount</th>
                        <th>Interest</th>

                        <th *ngIf="isUserLoggedIn()">Buy Now</th>
                        <th *ngIf="isAdminLoggedIn()">Edit</th>
                        <th *ngIf="isAdminLoggedIn()">Delete</th>


                    </tr>
                </thead>
                <tbody class="tbody">
                    <tr *ngFor="let policy of policies">
                        <td>{{policy.policyId}}</td>
                        <td>{{policy.policyName}}</td>
                        <td>{{policy.policyDescription}}</td>
                        <td>{{policy.company}}</td>
                        <td>{{policy.policyType}}</td>
                        <td>{{policy.initialDeposit}}</td>
                        <td>{{policy.termPeriod}}</td>
                        <td>{{policy.termAmount}}</td>
                        <td>{{policy.interest}}</td>

                        <td *ngIf="isUserLoggedIn()"><button type="button" class="btn button"
                                (click)="buyPolicy(policy.policyId)">Buy Now</button></td>
                        <!-- <td *ngIf="isAdminLoggedIn()"><button type="button">Edit</button></td> -->
                        <td *ngIf="isAdminLoggedIn()" (click)="deletePolicy(policy.policyId)"><button
                                class="btn btn-danger">Delete</button></td>

                    </tr>
                </tbody>

            </table>
        </div>

        
        <div class="select-dropdown">
            <label for="filterMethod">Select Filter Method:</label>
            <select id="filterMethod" (change)="onFilterMethodChange($event)">
                <option value="">Select Filter Method</option>
                <option value="getPolicyByPolicyType">Get Policies By Policy Type</option>
                <option *ngIf="isAdminLoggedIn() || isUserLoggedIn()" value="getPoliciesByCompany">Get Policies By
                    Company</option>
                <option *ngIf="isAdminLoggedIn() || isUserLoggedIn()" value="getByAmountGreaterThan">Get Policies By
                    Amount Greater Than</option>
                <option *ngIf="isAdminLoggedIn() || isUserLoggedIn()" value="getByAmountLessThan">Get Policies By Amount
                    Less Than</option>
            </select>
            <div *ngIf="selectedFilterMethod === 'getPolicyByPolicyType'">
                <label for="policyType">Select Policy Type:</label>
                <select id="policyType" (change)="onPolicyTypeChange($event)">
                    <option value="Vehicle Insurance">Vehicle Insurance</option>
                    <option value="Travel Insurance">Travel Insurance</option>
                    <option value="Life insurance">Life insurance</option>
                    <option value="Health Insurance">Health Insurance</option>
                    <option value="Child Plans">Child Plans</option>
                    <option value="Retirement Plans">Retirement Plans</option>
                </select>
            </div>

            <div *ngIf="selectedFilterMethod === 'getPoliciesByCompany'">
                <label for="company">Enter Company Name:</label>
                <input type="text" id="company" [(ngModel)]="company" placeholder="Enter company name">
                <button (click)="onGetPoliciesByCompany()">Search</button>
            </div>

            <div *ngIf="selectedFilterMethod === 'getByAmountGreaterThan'">
                <label for="greaterThanAmount">Enter Amount Greater Than:</label>
                <input type="number" id="greaterThanAmount" [(ngModel)]="greaterThanAmount" placeholder="Enter amount">
                <button (click)="onGetPoliciesByAmountGreaterThan()">Search</button>
            </div>

            <div *ngIf="selectedFilterMethod === 'getByAmountLessThan'">
                <label for="greaterThanAmount">Enter Amount Less Than:</label>
                <input type="number" id="lessThanAmount" [(ngModel)]="lessThanAmount" placeholder="Enter amount">
                <button (click)="onGetPoliciesByAmountLessThan()">Search</button>
            </div>
        </div>
        </div>










    <footer>
        <p>&copy; 2024 PoliCare. All rights reserved.</p>
    </footer>
</body>

</html>